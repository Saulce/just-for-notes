# Linux

## Linux 文件系统

在 Linux 操作系统中，一切被操作系统管理的资源，如网络接口卡、磁盘驱动器、打印机、输入输出设备、普通文件或目录等，都被视为文件。这是 Linux 系统中一个重要的概念，即"一切都是文件"。

这种概念源自 UNIX 哲学，即将所有资源都抽象为文件的方式来进行管理和访问。Linux 的文件系统也借鉴了 UNIX 文件系统的设计理念。这种设计使得 Linux 系统可以通过统一的文件接口来管理和操作不同类型的资源，从而实现了一种统一的文件操作方式。例如，可以使用类似于读写文件的方式来对待网络接口、磁盘驱动器、设备文件等，使得操作和管理这些资源更加统一和简便。这种文件为中心的设计理念为 Linux 系统带来了灵活性和可扩展性，使得 Linux 成为一种强大的操作系统。同时，这也是 Linux 系统的一大特点，深受广大用户和开发者的喜欢和推崇。

### inode 介绍

inode 是 Linux/Unix 文件系统的基础。那 inode 到是什么?有什么作用呢?

1. 硬盘的最小存储单位是扇区(Sector)，块(block)由多个扇区组成。文件数据存储在块中。块的最常见的大小是 4kb，约为 8 个连续的扇区组成（每个扇区存储 512 字节）。一个文件可能会占用多个 block，但是一个块只能存放一个文件。虽然，我们将文件存储在了块(block)中，但是我们还需要一个空间来存储文件的 **元信息 metadata**：如某个文件被分成几块、每一块在的地址、文件拥有者，创建时间，权限，大小等。这种 **存储文件元信息的区域就叫 inode**，译为索引节点：**i（index）+node**。 **每个文件都有一个唯一的 inode，存储文件的元信息。**
2. inode 是一种固定大小的数据结构，其大小在文件系统创建时就确定了，并且在文件的生命周期内保持不变。
3. inode 的访问速度非常快，因为系统可以直接通过 inode 号码定位到文件的元数据信息，无需遍历整个文件系统。
4. inode 的数量是有限的，每个文件系统只能包含固定数量的 inode。这意味着当文件系统中的 inode 用完时，无法再创建新的文件或目录，即使磁盘上还有可用空间。因此，在创建文件系统时，需要根据文件和目录的预期数量来合理分配 inode 的数量。
5. 可以使用 `stat` 命令可以查看文件的 inode 信息，包括文件的 inode 号、文件类型、权限、所有者、文件大小、修改时间。

简单来说：inode 就是用来维护某个文件被分成几块、每一块在的地址、文件拥有者，创建时间，权限，大小等信息。

再总结一下 inode 和 block：

- **inode**：记录文件的属性信息，可以使用 `stat` 命令查看 inode 信息。
- **block**：实际文件的内容，如果一个文件大于一个块时候，那么将占用多个 block，但是一个块只能存放一个文件。（因为数据是由 inode 指向的，如果有两个文件的数据存放在同一个块中，就会乱套了）

### 硬链接和软链接

### Linux 文件类型

Linux 支持很多文件类型，其中非常重要的文件类型有: 

- **普通文件（-）**：用于存储信息和数据， Linux 用户可以根据访问权限对普通文件进行查看、更改和删除。比如：图片、声音、PDF、text、视频、源代码等等。
- **目录文件（d，directory file）**：目录也是文件的一种，用于表示和管理系统中的文件，目录文件中包含一些文件名和子目录名。打开目录事实上就是打开目录文件。
- **符号链接文件（l，symbolic link）**：保留了指向文件的地址而不是文件本身。
- **字符设备（c，char）**：用来访问字符设备比如键盘。
- **设备文件（b，block）**：用来访问块设备比如硬盘、软盘。
- **管道文件(p，pipe)** : 一种特殊类型的文件，用于进程之间的通信。
- **套接字文件(s，socket)**：用于进程间的网络通信，也可以用于本机之间的非网络通信。

等。

### Linux 目录树

![](D:\.StudyWork\CodeBase\笔记\Linux\图片\Linux目录树-DzjzZEII.png)

**常见目录说明：**

- **/bin：** 存放二进制可执行文件(ls、cat、mkdir 等)，常用命令一般都在这里；
- **/etc：** 存放系统管理和配置文件；
- **/home：** 存放所有用户文件的根目录，是用户主目录的基点，比如用户 user 的主目录就是/home/user，可以用~user 表示；
- **/usr：** 用于存放系统应用程序；
- **/opt：** 额外安装的可选应用程序包所放置的位置。一般情况下，我们可以把 tomcat 等都安装到这里；
- **/proc：** 虚拟文件系统目录，是系统内存的映射。可直接访问这个目录来获取系统信息；
- **/root：** 超级用户（系统管理员）的主目录（特权阶级^o^）；
- **/sbin:** 存放二进制可执行文件，只有 root 才能访问。这里存放的是系统管理员使用的系统级别的管理命令和程序。如 ifconfig 等；
- **/dev：** 用于存放设备文件；
- **/mnt：** 系统管理员安装临时文件系统的安装点，系统提供这个目录是让用户临时挂载其他的文件系统；
- **/boot：** 存放用于系统引导时使用的各种文件；
- **/lib 和/lib64：** 存放着和系统运行相关的库文件 ；
- **/tmp：** 用于存放各种临时文件，是公用的临时文件存储点；
- **/var：** 用于存放运行时需要改变数据的文件，也是某些大文件的溢出区，比方说各种服务的日志文件（系统启动日志等。）等；
- **/lost+found：** 这个目录平时是空的，系统非正常关机而留下“无家可归”的文件（windows 下叫什么.chk）就在这里。

## 命令行（有大小写区分）

命令名称 [参数]...	（有些时候参数顺序不重要）	格式：

- -单个字母 [值（可选）] 
- --一个单词 [=值（可选）]

### 系统命令

- poweroff  关机	reboot  重启

RTFM阅读Manual

-  man (常用)	info (不怎么常用)	help		例如：man 5 passwd  查看passwd对应的5号文档信息

### 基本文件管理命令（增删改查）

- mkdir  创建目录
- touch  创建空白的普通文件（原用于修改文件的时间属性）
- cp  复制文件或目录
- rm  删除文件或目录
- mv  移动文件或目录或者重命名
- cd  修改当前所在工作目录的位置
- ls  查看目录的结构或者某个文件
- cat/ more/less/tail/head  将文件的内容显示在终端上
- pwd  查看当前所在的工作目录位置

### 数据流

stdin  输入（默认来源键盘）	stdout  输出（默认终端显示）	stderr  输出错误（默认终端显示）

#### 重定向（修改基本数据流方向）

- '<' ：输入重定向符号，左边为命令，右边为一个juicy的文件或别的输入流
- '> ：标准输出重定向符号，左边为命令，右边通常为一个文件路径
- '2>' ：标准错误输出重定向符号。左边为命令，右边通常为一个文件路径
- '>>' 或 '2>>' ：追加式写入

管道符：|	可连接两个命令，左侧的命令的标准输出会变为右侧命令的输入

**注：**1. 文件名区分大小写  2. 不能出现某些特殊字符  3. 普通文件名和目录名不能相同

### 文件编辑器

nano 上手难度低，操作逻辑接近Windows	vi/vim (推荐) (vim相较于vi提供插件支持)

**vim** : 

- insert mode (输入的内容被认为是文本的内容)    **按 esc 返回 ↓**
- command mode (打开文件默认状态)    **按 i 进入 ↑**        **按 : 进入 ↓**
- last line mode (主要涉及保存和退出)    **按退格直到 : 消失 ↑**
  - last line mode 常用命令：
    - wq  先保存再退出vim
    - q!  放弃保存直接退出
    - vimtutor  用于学习vim的各种初级到高级操作的训练场

### 用户管理

/etc/passwd 文件记录系统中所有的用户信息

<u>name : passwd : UID : GID : GECOS : directory : shell</u>

primary group  一般称为主组，一个用户必须有一个主组，一般情况下与用户名同名

additional group  称为从属组或附加组，一个用户可添加到多个从属组中

- useradd  增加用户
- groupadd  增加组
- userdel  删除用户
- groupdel  删除组
- usermod  修改用户信息
- passwd  修改用户的密码
- change  修改用户密码的属性
- id  查看具体某个用户的UID、GID和从属组信息（也可以通过直接查看文件/etc/passwd，/etc/shadow，/etc/group的内容的方式查看）

**重要原则：**能用命令完成的事情尽量使用命令完成，而非直接修改相关文件，因为命令可以校验修改的内容，防止出现错误信息或者格式错误

#### 权限管理		普通文件		目录文件

- r 读			cat可以查看数据		ls可以查看目录中有什么文件
- w 写                       vim可以修改数据              rm可以删除目录中的文件
- x 执行                    可以通过绝对或相对路径直接调用，类似于命令或程序运行              cd可以修改当前目录到此目录
- -无权限                  没有对应的权限                无
  - rwx	7	chmod 用于修改rwx部分的内容
  - rw-	 6	可基于数字表示  chmod 744 targetfile
  - r-x	  5	基于特定位置方法  chmod u+w/g-w/o=rw targetfile
  - r--	   4
  - -wx	 3	_ (文件所属用户权限u) _ (所属组权限g) _ (其他用户权限o)
  - -w-	  2	chown  修改所属用户和所属组
  - --x	   1
  - ---	    0

su  用户身份切换	su 用户名 / su -用户名

通过 sudo 完成一些需要使用其他用户身份完成的事件

#### SSH远程访问

ssh -p 端口号 用户@IP地址

常用**ssh客户端**软件：PuTTY、Xshell、MobaXterm ...

##### 密钥

非对称加密——公钥用于加密，私钥用于解密

- ssh-keygen  公私钥对生成命令
- ssh-copy-id  将公钥文件上传至远程主机的特定位置

当公钥或私钥丢失，整个匹配全部失效

### 网络配置

- nmcli  基于cli命令的管理方式	nmtui  基于tui界面的管理方式

- ip  查看当前网络设备名称和部分网络信息
- lo  本地回环设备，用于指向本地服务
  - ensl60  传统网卡设备
  - virbr0  虚拟网桥设备
  - virbr0-nic  辅助virbr设备

### 归档与压缩

归档：将特定的一个目录或多个文件转变为一个单独的文件  (.tar) tar命令

压缩：

- tar  不会进行任何数据压缩，并可以保留原有的目录结构、权限等信息
  - tar参数	-j, --bzip2：调用bzip2压缩算法，后缀.tar.bz2
    - 平均
  - -J, --xz：xz压缩算法，后缀.tar.xz
    - 压缩率最高，但最费时间，常用于二进制文件
  - -z, --gzip：gzip压缩算法，后缀.tar.gz
    - 最快，压缩率最低，常用于源代码或主要是文本文件

### 安装与卸载

1. 直接获取源码，然后配合相关工具链编译成可执行程序
2. 使用特定二进制包完成软件的安装

- 红帽系主要使用rpm命令（一般作为企业级服务器上的操作系统）
  - 针对RPM包，高级的包管理命令为 yum (旧) 和 dnf (新)
    - dnf install/upgrade/remove 软件名
    - dnf search 关键词
    - dnf makecache
    - dnf clean
- Debian系主要使用deb命令（一般作为PC或小型服务器上的操作系统）
  - 针对DEB包，高级的包管理命令为apt
- wget在终端上完成文件下载的主要命令

httpd 此软件用于提供web服务器的功能	mariaDB 数据库软件

例：dnf install httpd mariadb mariadb-server

注：国内的镜像站点：加快仓库的访问速度

##### wget, git  源码获取

#### GCC编译器

gcc, make  编译环境

- -s  看C语言编译器产生的汇编代码
- -c  编译并汇编目标代码  .c -> .o
- objdump -d 目标文件名.o  反汇编

#### GDB调试器

### 服务管理

- systemed  通过特定的文件的方式进行统一的服务管理
  - sevice  服务管理，即软件服务
  - socket  网络套接字管理，通常与网络服务或网络程序有关
  - target  通常用于指定特定一种运行要求或环境的状态
- systemed 统一使用 systemctl 命令管理服务
  - systemctl start sshd.service  启动sshd服务，实际是调用sshd.service文件中定义的启动命令
  - systemctl stop sshd.service  停止sshd服务
  - systemctl disable sshd.service  取消开机自启动
  - systemctl enable sshd.service  设置为开机自动，本质是将服务相关的文件拷贝至特定target中
  - systemctl status sshd.service  查看服务的工作状态
  - systemctl restart sshd.service  重启服务
  - systemctl reload sshd.service  重载服务（热重启，采用刷新机制）
    - 如：systemctl start httpd/mariadb.service

### 进程管理

- ps  会将执行命令的瞬间的进程状态打印
- top  类似于运行在终端上的任务管理器
- kill  使用该命令给进程发送signal来改变进程状态

### 文件管理系统

​	Linux上常用的文件系统为ext4和xfs，Windows上则为NTFS，支持多种fat32和exfat

- df  查看当前系统正在使用的文件系统，挂载磁盘的使用情况
- dd  创建一个全新的文件系统和设备，常用于在linux系统中进行数据的写入和读取操作（底层）
- mkfs  给文件里面安装ext4文件系统：mkfs.ext4
- mount  指定路径对应文件系统的访问入口（umount  解除关联）

文件内的配置格式：文件系统	挂载目录	文件系统类型	defaults	0	0

### 磁盘管理

​	Linux系统将所有存储设备都转变为了块设备文件

- lsblk  列出系统中所有的块设备文件信息
- fdisk  管理硬盘设备
- 分区表
  - mbr  又称DDS，MS-DOS分区表，相对古老……
  - gpt  一种现代化的磁盘分区格式……
- lvm 逻辑卷管理器  pv 物理卷  lv 逻辑卷  vg 卷组  pe 物理块

### 容器

容器管理软件：docker	podman(红帽推荐)	container.io

镜像：是一种静态资源，包含 一定数量的运行时的文件，是创建容器的根基

容量：是一种动态资源，由一个镜像构建出来，在操作系统上以进程方式呈现

镜像命名规则：镜像所在仓库站点.在仓库站点上归属的用户.名称（必要）.镜像的标签

#### 容器的管理

- podman as  查看当前用户下启动的容器
- podman exec  调用容器内的某个命令

创建和启动时的参数设定

- -p  指定外在主机和容器的端口绑定
- -d  容器后台运行

- -i  给容器提供一个STDIN

- -v  将本地目录挂载到容器内，让容器命令可以直接操作外面的主机的文件

### 防火墙管理

### shell脚本与编程

shell编程本质就是终端上的命令

shell脚本本质上是一个文件，内部包含需要手工输入的命令

- sh  最古老的shell程序，功能最少，但基本满足，且兼容性最高
- bash  最主流的shell程序，sh的升级版本，已成为shell规则的标准
- zsh  在bash基础上增加了对于自定义设置增强，自由性很高
- fish  一个不怎么需要配置的shell程序，初体验更高
- echo  输出字符串

#### 模式扩展（8种）

1. ~：会被自动扩展为用户目录的绝对路径\
2. ?：扩展成任意文件路径中的单个任意非空字符，需要多个字符时使用多个'?'
3. *：用于扩展文件路径中任意数量的字符（包括'/'）但不包括以 '.' 作为开头的文件
4. []：用于指定扩展单个特定范围内的字符，也用于文件路径的扩展
5. {}：主要用于构建shell中的数组
6. 变量：可以定义变量且可以获取变量值（$取值符）
7. 子命令：可以使用一种特殊的格式来获取一个命令的执行结果，支持嵌套调用
8. 算数：在shell上可以进行一些简单的整数运算

#### 转义字符

- env  显示一些定义的环境变量

**环境变量**

- PATH  决定命令的搜索范围（可直接使用命令名而不需要绝/相对路径）
- LANG  字符集和语言编码
- RANDOM  随机得到一个在0和32767范围内的整数
- …

#### shell配置

~/.bashrc：每次启动shell时加载，针对用户

~/.bash_profile：登录系统后加载一次，针对用户

/etc/bashrc：全局配置

特殊变量：$?  此方法得到的值为上一个命令的返回值，0为上个命令执行成功，非0则为失败

#### 三剑客

1. grep  基于正则表达式对内容进行提取
2. sed  可使用命令行的方式直接对文本文件进行一些操作，无需vim等
3. awk  可用来获取系统中所有的用户

使用 sed与gawk 进行高级脚本编程